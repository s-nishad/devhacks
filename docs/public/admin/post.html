<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    header { background: #222; color: #fff; padding: 20px; text-align: center; }
    h1 { margin: 0; font-size: 1.8em; }
    main { display: flex; height: calc(100vh - 80px); }
    #editor, #preview { width: 50%; padding: 20px; overflow-y: auto; }
    #editor { background: #fff; border-right: 1px solid #ccc; display: flex; flex-direction: column; }
    #editor input { padding: 10px; font-size: 1em; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
    #editor textarea { flex: 1; padding: 10px; font-family: monospace; font-size: 1em; border: 1px solid #ccc; border-radius: 4px; resize: none; }
    #editor button { padding: 10px; margin-top: 10px; background: #28a745; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    #editor button:hover { background: #218838; }
    #preview { background: #fafafa; border-left: 1px solid #ccc; }
    #status { margin-top: 10px; font-weight: bold; }
    pre { background: #eee; padding: 10px; overflow-x: auto; }
    code { font-family: monospace; }
  </style>
</head>
<body>
  <header>
    <h1>Nishad's Secret Zone</h1>
  </header>
  <main>
    <div id="editor">
      <input type="text" id="title" placeholder="Post Title" required />
      <textarea id="content" placeholder="Write your markdown here..." required></textarea>
      <button id="uploadBtn">Upload Post</button>
      <p id="status"></p>
    </div>
    <div id="preview">
      <h2>Live Preview</h2>
      <div id="previewContent"></div>
    </div>
  </main>

  <script>
    const token = prompt("Enter your GitHub Personal Access Token:");
    const owner = 's-nishad';
    const repo = 'devhacks';
    const folder = 'blog'; // or 'hacks'

    const titleInput = document.getElementById('title');
    const contentInput = document.getElementById('content');
    const previewDiv = document.getElementById('previewContent');
    const statusDiv = document.getElementById('status');
    const uploadBtn = document.getElementById('uploadBtn');

    // Live preview
    contentInput.addEventListener('input', () => {
      previewDiv.innerHTML = marked.parse(contentInput.value);
    });

    // Capitalize words
    const capitalizeWords = str => str.split(/[-_ ]+/).map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');

    // Upload handler
    uploadBtn.addEventListener('click', async () => {
      const title = titleInput.value.trim();
      const content = contentInput.value;

      if (!title || !content) {
        statusDiv.textContent = '❌ Title and content are required!';
        return;
      }

      const filename = title.toLowerCase().replace(/\s+/g, '-') + '.md';
      const path = `${folder}/${filename}`;
      const body = {
        message: `Add new post: ${capitalizeWords(title)}`,
        content: btoa(unescape(encodeURIComponent(content)))
      };

      try {
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
          method: 'PUT',
          headers: { Authorization: `token ${token}`, 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        if (res.ok) {
          statusDiv.textContent = `✅ Post uploaded: ${capitalizeWords(title)}`;
          titleInput.value = '';
          contentInput.value = '';
          previewDiv.innerHTML = '';
        } else {
          const err = await res.json();
          statusDiv.textContent = `❌ Error: ${err.message}`;
        }
      } catch (err) {
        statusDiv.textContent = `❌ Error: ${err.message}`;
      }
    });
  </script>
</body>
</html>
